# OCR 2.0 –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Äî README

## üöÄ –û –ø—Ä–æ–µ–∫—Ç–µ
–¶–µ–ª—å ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å **–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é OCR‚Äë—Å–∏—Å—Ç–µ–º—É** –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—á–µ–∫–∏, –¥–æ–≥–æ–≤–æ—Ä—ã, –≤—ã–ø–∏—Å–∫–∏), –∫–æ—Ç–æ—Ä–∞—è **–ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç baseline (Tesseract)** –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç:
- **baseline** (Tesseract, rule‚Äëbased —à–∞–±–ª–æ–Ω—ã);
- **—É–ª—É—á—à–µ–Ω–Ω—É—é –ø–∞–π–ø–ª–∞–π–Ω‚Äë—Å–∏—Å—Ç–µ–º—É** –Ω–∞ –±–∞–∑–µ **PaddleOCR** + –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π + –ø–æ—Å—Ç‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–∞;
- **–¥–µ–º–æ‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –Ω–∞ Streamlit;
- **—Å–∫—Ä–∏–ø—Ç—ã –æ—Ü–µ–Ω–∫–∏** –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ.

> –ö–µ–π—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ¬´–¢–ó 2. OCR 2.0 –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤¬ª. –ò—Ç–æ–≥–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å baseline –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º + —Å–∫—Ä—ã—Ç–æ–º –Ω–∞–±–æ—Ä–∞—Ö.


## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
TASK-2/
‚îú‚îÄ demo/
‚îÇ  ‚îî‚îÄ app_streamlit.py             # –¥–µ–º–æ UI
‚îú‚îÄ src/
‚îÇ  ‚îú‚îÄ pipeline.py                  # –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä
‚îÇ  ‚îú‚îÄ ocr_paddle.py                # –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ PaddleOCR
‚îÇ  ‚îú‚îÄ ocr_tesseract.py             # baseline –Ω–∞ pytesseract
‚îÇ  ‚îú‚îÄ preproc.py                   # –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ (–±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ, —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ)
‚îÇ  ‚îú‚îÄ post_llm.py                  # –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∏, LLM-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
‚îÇ  ‚îú‚îÄ pdf_utils.py                 # (–æ–ø—Ü.) –æ–±—Ä–∞–±–æ—Ç–∫–∞ PDF —á–µ—Ä–µ–∑ PyMuPDF (fitz)
‚îÇ  ‚îî‚îÄ schemas.py                   # —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö/–≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
‚îú‚îÄ requirements.txt
‚îú‚îÄ config.yaml                     # –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ (—è–∑—ã–∫, –º–æ–¥–µ–ª–∏, –ø–æ—Ä–æ–≥–∏, –ø—É—Ç–∏)
‚îî‚îÄ README.md                       # —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

**–í–∞–∂–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ:** –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π –∏–¥—ë—Ç –∏–∑ –ø–∞–∫–µ—Ç–∞ `src`. –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –∫–æ—Ä–Ω—è, —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ –ø–æ–¥–ø–∞–ø–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `demo/`) –∏—Å–ø–æ–ª—å–∑—É–µ–º _–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω—è –≤ `PYTHONPATH`_ –∏–ª–∏ –ø—Ä–∞–≤–∏–º `sys.path` (—Å–º. –Ω–∏–∂–µ).


## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **Python 3.12+** (–º–∏–Ω–∏–º—É–º 3.10; –≤ 3.9 –Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `X | Y` –¥–ª—è —Ç–∏–ø–æ–≤ ‚Üí –æ—à–∏–±–∫–∞ –≤–∏–¥–∞ _‚ÄúPython version 3.9 does not allow writing union types as X | Y‚Äù_);
- macOS / Linux / Windows;
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `venv` –∏–ª–∏ `conda`.

### –ë–∞–∑–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```
paddleocr>=2.7.0
paddlepaddle>=2.6.0          # CPU-–≤–µ—Ä—Å–∏—è; –¥–ª—è GPU —Å–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Paddle
pytesseract>=0.3.10
opencv-python>=4.9.0.80
numpy, pillow, pydantic
python-dotenv, pyyaml, loguru
streamlit
# –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã PDF:
pymupdf
```
> –î–ª—è macOS / Apple Silicon –∏–Ω–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `conda` (–æ—Å–æ–±–µ–Ω–Ω–æ `opencv`).


## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (—á–∏—Å—Ç–∞—è)
```bash
# 0) –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
python3.12 -m venv .venv
source .venv/bin/activate           # Windows: .venv\Scripts\activate
python -V                           # –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Python 3.12+
pip install --upgrade pip

# 1) —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 2) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Tesseract –¥–ª—è baseline
#   macOS (brew):    brew install tesseract
#   Ubuntu/Debian:   sudo apt-get install tesseract-ocr tesseract-ocr-rus

# 3) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) PaddlePaddle GPU ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ñ. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ–¥ –≤–∞—à—É CUDA/cuDNN
```

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ PaddleOCR
```python
from paddleocr import PaddleOCR
ocr = PaddleOCR(lang='ru')    # —Ä—É—Å—Å–∫–∞—è –º–æ–¥–µ–ª—å; –º–æ–∂–Ω–æ 'en', 'ru', 'en+ru'
```
–ï—Å–ª–∏ **`ModuleNotFoundError: No module named 'paddleocr'`**, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ `.venv` –∏ —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—à–ª–∞ –±–µ–∑ –æ—à–∏–±–æ–∫.


## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–§–∞–π–ª **`config.yaml`** (–ø—Ä–∏–º–µ—Ä):
```yaml
language: "ru"            # 'ru' | 'en' | 'en+ru'
use_gpu: false
preproc:
  denoise: true
  deskew: true
  adaptive_threshold: true
ocr:
  engine: "paddle"        # 'paddle' | 'tesseract'
  cls: true               # –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
postproc:
  normalize_spaces: true
  fix_common_mistakes: true
  enable_field_parsing: true
eval:
  dataset_dir: "data/public_eval"
  metrics: ["cer", "wer", "field_f1"]
```

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞
1. **–ó–∞–≥—Ä—É–∑–∫–∞** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è / PDF‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü—ã (`pdf_utils.extract_pages`).
2. **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞** (`preproc.py`): –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ, –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è, —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞.
3. **OCR**:
   - **baseline:** `pytesseract.image_to_data` (—Å —è–∑—ã–∫–æ–º `rus` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏);
   - **improved:** `PaddleOCR(lang='ru', cls=True)` —Å –ø–æ—Å—Ç‚Äë—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –±–æ–∫—Å–æ–≤ –∏ confidence.
4. **–ü–æ—Å—Ç‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–∞** (`post_llm.py`, `schemas.py`):
   - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤;
   - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π (–§–ò–û, –ò–ò–ù/–ë–ò–ù, —Å—É–º–º—ã, –¥–∞—Ç—ã, IBAN/BIC, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞);
   - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ regex/—á–µ–∫‚Äë—Å—É–º–º–∞–º;
   - (–æ–ø—Ü.) LLM‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –ª–æ–≥–∞–º–∏ –∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏).

5. **–û—Ü–µ–Ω–∫–∞**: CER/WER –ø–æ —Ç–µ–∫—Å—Ç—É, F1 –ø–æ –ø–æ–ª—è–º (—Ç–æ—á–Ω–æ—Å—Ç—å, –ø–æ–ª–Ω–æ—Ç–∞).

–î–∏–∞–≥—Ä–∞–º–º–∞ –¥–∞–Ω–Ω—ã—Ö (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):
```
Image/PDF ‚Üí Preproc ‚Üí OCR ‚Üí Postproc (fields) ‚Üí JSON (text, boxes, fields, confidences)
```


## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –¥–µ–º–æ (Streamlit)
–ò–∑ **–∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞** (—á—Ç–æ–±—ã `src` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∑–æ–ª–≤–∏–ª—Å—è):
```bash
streamlit run demo/app_streamlit.py
```
–ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∏–∑ `demo/` –∏ –≤–∏–¥–∏—Ç–µ `ModuleNotFoundError: No module named 'src'`:
- –õ–∏–±–æ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ **–∏–∑ –∫–æ—Ä–Ω—è**;
- –õ–∏–±–æ –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ `demo/app_streamlit.py`:
  ```python
  import sys, os
  sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))
  ```

## üß™ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline
### 1) –ó–∞–ø—É—Å–∫ baseline (Tesseract)
```bash
python -m src.pipeline --engine tesseract --input data/samples --out out/baseline
```
### 2) –ó–∞–ø—É—Å–∫ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ (PaddleOCR)
```bash
python -m src.pipeline --engine paddle --lang ru --input data/samples --out out/paddle
```
### 3) –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
```bash
python -m src.eval --pred out/paddle --gt data/labels --metrics cer wer field_f1
```
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `out/metrics.json` –∏ –ª–æ–≥–∞—Ö.


## üó£ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- **PaddleOCR**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `PaddleOCR(lang="ru", cls=True)` ‚Äî —ç—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —Ä—É—Å—Å–∫—É—é —Ä–∞–∑–º–µ—Ç–∫—É –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü.
- **Tesseract**: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —è–∑—ã–∫–æ–≤–æ–π –ø–∞–∫–µ—Ç `rus` (—Å–º. —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤—ã—à–µ) –∏ –≤ –∫–æ–¥–µ –∑–∞–¥–∞–π—Ç–µ `lang='rus'`.

**–ï—Å–ª–∏ ¬´–Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞—Å—á—ë—Ç —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞¬ª:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥–µ–ª—å/–ø–∞–∫–µ—Ç –¥–ª—è `ru` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω;
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è **–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä—É–ø–Ω—ã–µ** (–º–∏–Ω–∏–º—É–º ~120 DPI) ‚Äî —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–µ —Å–∫–∞–Ω—ã –ª–æ–º–∞—é—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ;
3. –í–∫–ª—é—á–∏—Ç–µ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É: –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ, –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—é, –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–µ–∑–∫–æ—Å—Ç–∏;
4. –õ–æ–≥–∏–∫—É `postproc` –¥–µ—Ä–∂–∏—Ç–µ **—è–∑—ã–∫–æ‚Äë–∑–∞–≤–∏—Å–∏–º–æ–π** (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ vs –ª–∞—Ç–∏–Ω–∏—Ü–∞, –∑–∞–º–µ–Ω—ã `–û/0`, `–í/8`, `–°/–°`, –∏ —Ç.–¥.).


## üìÑ –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PyMuPDF (pymupdf)
–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å PDF, –∏—Å–ø–æ–ª—å–∑—É–µ–º `src/pdf_utils.py` (–ø—Ä–∏–º–µ—Ä):
```python
import fitz  # pymupdf

def extract_pages(pdf_path):
    doc = fitz.open(pdf_path)
    for page in doc:
        pix = page.get_pixmap(dpi=200)  # 200-300 DPI ‚Äî —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å
        yield Image.frombytes("RGB", [pix.width, pix.height], pix.samples)
```
‚Üí –ó–∞—Ç–µ–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥–æ–Ω—è–µ–º –ø–æ –∫–æ–Ω–≤–µ–π–µ—Ä—É (`preproc ‚Üí ocr ‚Üí postproc`).


## üßØ –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

### 1) **Python 3.9 union types** / —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´Python version 3.9 does not allow writing union types as X | Y¬ª
- –í—ã —É–∂–µ **–æ–±–Ω–æ–≤–∏–ª–∏ Python**, –Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤—Å—ë –µ—â—ë —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ 3.9.
  - –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∏ **–ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ** venv –Ω–∞ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:
    ```bash
    deactivate || true
    rm -rf .venv
    python3.12 -m venv .venv
    source .venv/bin/activate
    python -V  # –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 3.12.x
    pip install -r requirements.txt
    ```
  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ IDE/—Ç–µ—Ä–º–∏–Ω–∞–ª –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏–º–µ–Ω–Ω–æ –∏–∑ **–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ** –æ–∫—Ä—É–∂–µ–Ω–∏—è.

### 2) `ModuleNotFoundError: No module named 'paddleocr'`
- –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ venv –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
  ```bash
  pip install --upgrade pip
  pip install paddlepaddle paddleocr
  ```
- –î–ª—è Apple Silicon –∏ Linux –±–µ–∑ AVX –∏–Ω–æ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `conda`/–∞—Ä—Ö–∏–≤—ã (—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ñ. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Paddle).

### 3) `ModuleNotFoundError: No module named 'src'`
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã **–∏–∑ –∫–æ—Ä–Ω—è** –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ—Ä–µ–Ω—å –≤ `PYTHONPATH`/`sys.path` (—Å–º. –≤—ã—à–µ).

### 4) –û—à–∏–±–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ `opencv`
- macOS: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ `pip install opencv-python` –≤ —á–∏—Å—Ç–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏; –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö ‚Äî `conda install -c conda-forge opencv`.

### 5) –ú–µ–¥–ª–µ–Ω–Ω–∞—è/–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ PaddleOCR
- –í—ã–∫–ª—é—á–∏—Ç–µ GPU (–µ—Å–ª–∏ –Ω–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π CUDA): `use_gpu: false`;
- –°–Ω–∏–∑—å—Ç–µ DPI —Ä–µ–Ω–¥–µ—Ä–∞ –¥–ª—è PDF (–Ω–∞–ø—Ä–∏–º–µ—Ä, 200 DPI);
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–µ.


## üß± –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞: `src/ocr_paddle.py`
```python
from paddleocr import PaddleOCR
from PIL import Image
import numpy as np

class PaddleEngine:
    def __init__(self, lang: str = "ru", use_gpu: bool = False):
        self.ocr = PaddleOCR(lang=lang, use_gpu=use_gpu, cls=True)

    def run(self, img: Image.Image):
        arr = np.array(img)
        res = self.ocr.ocr(arr, cls=True)
        out = []
        if res and res[0]:
            for det, (text, conf) in res[0]:
                x1,y1,x2,y2,x3,y3,x4,y4 = [int(v) for p in det for v in p]
                out.append({
                    "bbox": [x1,y1,x2,y2,x3,y3,x4,y4],
                    "text": text,
                    "conf": float(conf)
                })
        return out
```

## üß™ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞
```bash
python -m src.pipeline \
  --engine paddle \
  --lang ru \
  --input data/samples \
  --out out/run-$(date +%Y%m%d-%H%M)
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏
- **CER/WER** ‚Äî —Å–∏–º–≤–æ–ª—å–Ω–∞—è/—Å–ª–æ–≤–µ—Å–Ω–∞—è –æ—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è;
- **Field F1** ‚Äî F1‚Äë–º–µ—Ä–∞ –ø–æ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–º –∫–ª—é—á–µ–≤—ã–º –ø–æ–ª—è–º (exact match/normalized match);
- –û—Ç—á—ë—Ç—ã: `out/metrics.json`, `out/report.html` (–æ–ø—Ü.).


## üß∞ –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
- –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ **–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏** –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–æ/–ø–æ—Å–ª–µ) ‚Äî —ç—Ç–æ —Å–∏–ª—å–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –¥–µ–±–∞–≥—É;
- –õ–æ–≥–∏—Ä—É–π—Ç–µ **confidence** –∏ —Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è;
- –î–ª—è —Ç–∞–±–ª–∏—Ü (–≤—ã–ø–∏—Å–∫–∏) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—é/–ª–∏–Ω–µ–π–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ OpenCV;
- –î–ª—è —á–µ–∫–æ–≤ ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã + —É—Å–∏–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞;
- –î–ª—è –¥–∞—Ç/—Å—É–º–º ‚Äî —Ä–µ–≥—É–ª—è—Ä–∫–∏ + –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã (IBAN/BIC/–ò–ò–ù/–ë–ò–ù).


## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ **–ø—É–±–ª–∏—á–Ω—ã–µ** –∏–ª–∏ **—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ** –Ω–∞–±–æ—Ä—ã –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Ñ–æ—Ä–º/—á–µ–∫–æ–≤;
- –£–¥–∞–ª—è–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–ø–æ—Ä—Ç–æ–≤/–ø—Ä–∏–º–µ—Ä–æ–≤.


## üßæ –ò—Å—Ç–æ—Ä–∏—è —Ç–∏–ø–∏—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤/–æ—à–∏–±–æ–∫
- ¬´**–Ø –ø–æ—Å—Ç–∞–≤–∏–ª —Ä—É‚Äë–º–æ–¥–µ–ª—å, –Ω–æ —Ä—É—Å—Å–∫–∏–π –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è**¬ª ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ DPI/—Ä–∞–∑–º–µ—Ä, –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É, –Ω–∞–ª–∏—á–∏–µ `lang='ru'`, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–≤–∫–ª—é—á–∏—Ç–µ `cls=True`).
- ¬´**–û–±–Ω–æ–≤–∏–ª Python, –Ω–æ –ø—Ä–æ–µ–∫—Ç –≤—Å—ë –µ—â—ë —Ä—É–≥–∞–µ—Ç—Å—è –Ω–∞ 3.9**¬ª ‚Üí –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ —Å—Ç–∞—Ä–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ; –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ `.venv` –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ `python -V`.
- ¬´**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pymupdf`?**¬ª ‚Üí –≤ `src/pdf_utils.py` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü PDF –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –Ω—É–∂–Ω—ã–º DPI –ø–µ—Ä–µ–¥ OCR.
- ¬´**`ModuleNotFoundError: No module named 'src'`**¬ª ‚Üí –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –∏–∑ –∫–æ—Ä–Ω—è –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø—É—Ç—å, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ó–∞–ø—É—Å–∫ –¥–µ–º–æ¬ª.


## ‚úÖ –ß–µ–∫‚Äë–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π
- [ ] –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ –¥–µ–º–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —á–∏—Å—Ç–æ–π –º–∞—à–∏–Ω–µ (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã);
- [ ] –û—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º –Ω–∞–±–æ—Ä–µ ‚â• baseline –ø–æ CER/WER –∏ Field‚ÄëF1;
- [ ] –í –æ—Ç—á—ë—Ç–µ –æ–ø–∏—Å–∞–Ω—ã –æ—à–∏–±–∫–∏/—É–≥–æ–ª–∫–∏ –∫–µ–π—Å–æ–≤ –∏ –∫–∞–∫ –≤—ã –∏—Ö —É–ª—É—á—à–∞–ª–∏;
- [ ] –ï—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤—Ö–æ–¥ ‚Üí –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –±–æ–∫—Å—ã ‚Üí —Ç–µ–∫—Å—Ç ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è ‚Üí –º–µ—Ç—Ä–∏–∫–∏.

